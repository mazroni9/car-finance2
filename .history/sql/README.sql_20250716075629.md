# دليل ملفات SQL – مشروع car-finance

هذا المجلد يحتوي على ملفات إعداد قاعدة البيانات الخاصة بمنصة `car-finance`.

---

## 📁 محتويات المجلد

| الملف                          | الوصف                                                                 |
|-------------------------------|------------------------------------------------------------------------|
| `restore_original_schema.sql` | **الإسكيم الأصلي** - يحتوي على جميع الجداول والوظائف المطلوبة |
| `RESTORE_ORIGINAL_SCHEMA.md` | دليل مفصل للإسكيم الأصلي وكيفية تطبيقه |

---

## 🛠️ خطوات التنفيذ

1. **تطبيق الإسكيم الأصلي:**
   - اذهب إلى لوحة تحكم Supabase
   - افتح SQL Editor
   - انسخ محتوى `restore_original_schema.sql`
   - اضغط Run لتنفيذ الإسكيم

2. **التحقق من التطبيق:**
   - تأكد من إنشاء جميع الجداول
   - تحقق من وجود البيانات التجريبية
   - اختبر عمل API `/api/cars`

---

## ✅ ملاحظات مهمة

- **الإسكيم الأصلي** يحافظ على منطق التأجير الصحيح
- يحتوي على **بيانات تجريبية** جاهزة للاستخدام
- يتضمن **جميع الوظائف والـ Triggers** المطلوبة
- **محدث ليتناسب مع الكود الحالي** في التطبيق

---

## 🔄 التحديثات المستقبلية

لإضافة تحديثات جديدة:
1. أضف ملفات SQL في مجلد `migrations/`
2. أو قم بتحديث `restore_original_schema.sql` مباشرة
3. احتفظ بنسخة احتياطية قبل التحديث

---

## 📊 الجداول الرئيسية

### جداول السيارات والمعارض
- `car_showcase` - جدول السيارات الرئيسي (مع image_url كـ text[])
- `users` - جدول المستخدمين
- `customers` - جدول العملاء

### جداول المحافظ والمعاملات
- `wallets` - محافظ المستخدمين
- `wallet_transactions` - معاملات المحافظ

### جداول التمويل والتقسيط
- `financing_requests` - طلبات التمويل
- `finance_transactions` - العمليات المالية
- `installment_rules` - قواعد التقسيط

---

## 🚀 الدوال المتاحة

- `update_car_showcase_updated_at()` - تحديث timestamp السيارة
- `get_financial_summary()` - حساب الملخص المالي الأصلي

---

## 🔧 استكشاف الأخطاء

إذا واجهت مشاكل:
1. تحقق من متغيرات البيئة في `.env.local`
2. تأكد من تطبيق الإسكيم بنجاح
3. راقب كونسول السيرفر للأخطاء
4. راجع `RESTORE_ORIGINAL_SCHEMA.md` للتفاصيل

---

## ⚠️ ملاحظة مهمة

**تم حذف الإسكيم الموحد** لأنه سبب مشاكل في البيانات والحسابات. 
يجب استخدام **الإسكيم الأصلي** فقط للحفاظ على منطق التأجير الصحيح.

---

**ملاحظة:** هذا الإسكيم الأصلي يحافظ على منطق التأجير الصحيح ويضمن عمل المنصة بشكل صحيح.

تم تحديثه في 2025-01-XX