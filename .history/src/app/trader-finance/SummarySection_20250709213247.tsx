"use client";
import React from 'react';

const calculateMonthlyResults = (details, entries) => {
  const totalOperations = details.reduce(
    (sum, d) => sum + (Number(d.operationsMonthly) || 0),
    0
  );

  const totalCapital = details.reduce(
    (sum, d) => sum + (Number(d.capital) || 0),
    0
  );

  const transferFees = totalOperations * 117;
  const floorFees = totalOperations * 250;

  let subscriptions = 0;
  for (const entry of entries) {
    const count = details.filter(
      (d) => Number(d.financingRate) === Number(entry.financingRate)
    ).length;
    subscriptions += count * (entry.monthlySubscription || 0);
  }

  const netProfit = subscriptions + transferFees + floorFees;

  return {
    totalOperations,
    totalCapital,
    transferFees,
    floorFees,
    subscriptions,
    netProfit
  };
};

export default function SummarySection({ allMonthlyDetails, entries }) {
  const monthNames = [
    'ููุงูุฑ', 'ูุจุฑุงูุฑ', 'ูุงุฑุณ', 'ุฃุจุฑูู', 'ูุงูู', 'ููููู',
    'ููููู', 'ุฃุบุณุทุณ', 'ุณุจุชูุจุฑ', 'ุฃูุชูุจุฑ', 'ููููุจุฑ', 'ุฏูุณูุจุฑ'
  ];

  // โ ุฌูุน ูุชุงุฆุฌ ูู ุดูุฑ ูู ูุตูููุฉ
  const monthlyResults = monthNames.map((month) => ({
    month,
    ...calculateMonthlyResults(allMonthlyDetails[month] || [], entries)
  }));

  // โ ุญุณุงุจ ุงูุฅุฌูุงููุงุช ุงูุณูููุฉ
  const yearlyTotals = monthlyResults.reduce(
    (acc, item) => {
      acc.subscriptions += item.subscriptions;
      acc.transferFees += item.transferFees;
      acc.floorFees += item.floorFees;
      acc.totalOperations += item.totalOperations;
      acc.totalCapital += item.totalCapital;
      acc.netProfit += item.netProfit;
      return acc;
    },
    {
      subscriptions: 0,
      transferFees: 0,
      floorFees: 0,
      totalOperations: 0,
      totalCapital: 0,
      netProfit: 0
    }
  );

  return (
    <div className="mb-8">
      <h2 className="text-xl font-bold text-center mb-2 text-green-700">
        ๐๏ธ ุงููุชุงุฆุฌ ุงูุดูุฑูุฉ ุงูุชูุตูููุฉ
      </h2>

      <div className="overflow-x-auto mb-6">
        <table className="table-auto w-full border mb-3">
          <thead>
            <tr className="bg-green-800">
              <th className="text-white p-2">ุงูุดูุฑ</th>
              <th className="text-white p-2">ุงูุงุดุชุฑุงูุงุช</th>
              <th className="text-white p-2">ุฑุณูู ููู ุงูููููุฉ</th>
              <th className="text-white p-2">ุฑุณูู ุงูุฃุฑุถูุงุช</th>
              <th className="text-white p-2">ุนุฏุฏ ุงูุนูููุงุช</th>
              <th className="text-white p-2">ุฑุฃุณ ุงููุงู</th>
              <th className="text-white p-2">ุตุงูู ุงูุฑุจุญ</th>
            </tr>
          </thead>
          <tbody>
            {monthlyResults.map((res, i) => (
              <tr key={i}>
                <td className="border p-1 text-center">{res.month}</td>
                <td className="border p-1 text-center">{res.subscriptions.toLocaleString()} ุฑูุงู</td>
                <td className="border p-1 text-center">{res.transferFees.toLocaleString()} ุฑูุงู</td>
                <td className="border p-1 text-center">{res.floorFees.toLocaleString()} ุฑูุงู</td>
                <td className="border p-1 text-center">{res.totalOperations}</td>
                <td className="border p-1 text-center">{res.totalCapital.toLocaleString()} ุฑูุงู</td>
                <td className="border p-1 text-center font-bold text-green-700">{res.netProfit.toLocaleString()} ุฑูุงู</td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>

      <h2 className="text-xl font-bold text-center mb-2 text-green-700">
        ๐ ุงููุชุงุฆุฌ ุงูุณูููุฉ ุงููุฌูุนุฉ
      </h2>

      <div className="overflow-x-auto">
        <table className="table-auto w-full border mb-3">
          <tbody>
            <tr>
              <td className="border p-2">ุฅุฌูุงูู ุงูุงุดุชุฑุงูุงุช ุงูุณูููุฉ</td>
              <td className="border p-2 text-center">{yearlyTotals.subscriptions.toLocaleString()} ุฑูุงู</td>
            </tr>
            <tr>
              <td className="border p-2">ุฑุณูู ููู ุงูููููุฉ ุงูุฅุฌูุงููุฉ</td>
              <td className="border p-2 text-center">{yearlyTotals.transferFees.toLocaleString()} ุฑูุงู</td>
            </tr>
            <tr>
              <td className="border p-2">ุฑุณูู ุงูุฃุฑุถูุงุช ุงูุฅุฌูุงููุฉ</td>
              <td className="border p-2 text-center">{yearlyTotals.floorFees.toLocaleString()} ุฑูุงู</td>
            </tr>
            <tr>
              <td className="border p-2">ุนุฏุฏ ุงูุนูููุงุช ุงูุฅุฌูุงููุฉ</td>
              <td className="border p-2 text-center">{yearlyTotals.totalOperations}</td>
            </tr>
            <tr>
              <td className="border p-2">ูุฌููุน ุฑุฃุณ ุงููุงู ุงูุฅุฌูุงูู</td>
              <td className="border p-2 text-center">{yearlyTotals.totalCapital.toLocaleString()} ุฑูุงู</td>
            </tr>
            <tr className="bg-black font-bold">
              <td className="border p-2 text-white">โ ุตุงูู ุงูุฑุจุญ ุงูุณููู ุงูููุฏุฑ</td>
              <td className="border p-2 text-center text-white">{yearlyTotals.netProfit.toLocaleString()} ุฑูุงู</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  );
}
